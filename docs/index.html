<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
 
    <link rel="stylesheet" href="css/fw2020.css">
    
    <title>RubyGateway  Reference</title>
    
  </head>
  <body data-root-path="./">

  <header class="j2-header">
  <div class="navbar navbar-expand navbar-dark j2-titlebar">
    <a class="sr-only-focusable sr-only font-weight-slightly-bold pr-2" href="#main-content">Skip to main content</a>
    <a class="nav-item nav-link pl-0 pt-1 pr-2 d-md-none" id="nav-toggle-button" role="button" aria-controls="nav-column" aria-expanded="false" aria-label="Toggle navigation" href="#">
      <span class="navbar-toggler-icon"></span>
    </a>
  
    <div style="align-items-baseline">
      <div class="navbar-brand mr-1 font-weight-slightly-bold">
        <a href="index.html">RubyGateway 3.2.0 Docs</a>
      </div>
      <span class="navbar-text j2-coverage font-weight-slightly-bold small d-none d-lg-inline-block mr-2">(100% documented)</span>
    </div>
  
    <div class="navbar-nav ml-auto justify-content-end flex-fill">
  
      <form class="form-inline d-none d-md-flex" role="search">
        <input class="form-control form-control-sm w-100" type="search" placeHolder="Search" aria-label="Search" aria-keyshortcuts="/" data-search-format="span">
      </form>
  
      <a class="nav-item nav-link d-none d-sm-inline" rel="external" href="https://github.com/johnfairh/RubyGateway">
        <svg class="j2-title-svg" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 16 16"><title>Open on GitHub</title><path fill="currentcolor" fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
        </svg>
      </a>
  
    </div>
  </div>
  
  <!-- narrow-style searchbar -->
  
  <div class="container-fluid j2-titlebar d-md-none">
    <div class="row">
      <div class="col">
        <form class="pb-2">
          <input class="form-control form-control-sm" type="search" placeHolder="Search" aria-label="Search" aria-keyshortcuts="/" data-search-format="div">
        </form>
      </div>
    </div>
  </div>

  <!-- breadcrumb bar, jazzy doesn't really support -->

  <nav aria-label="breadcrumb" class="small">
    <ol class="breadcrumb j2-breadcrumb">
      <li class="breadcrumb-item"><a href="index.html">RubyGateway Reference</a></li>
      <li class="breadcrumb-item" aria-current="page">RubyGateway  Reference</li>
    </ol>
  </nav>

  </header>

  <div class="container-fluid">
    <div class="row">
      <div class="col-auto d-none d-md-flex flex-column j2-nav" id="nav-column">
        <nav aria-label="swift" class="j2-swift">
          <ul class="j2-nav-list">
            <li class="j2-nav-group">
              <a class="j2-nav-item" href="Guides.html">Guides</a>
              <ul class="j2-nav-sublist">
                <li>
                  <a class="j2-nav-item" href="user-guide.html">User Guide</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="todo.html">TODO</a>
                </li>
              </ul>
            </li>
            <li class="j2-nav-group">
              <a class="j2-nav-item" href="Main%20APIs.html">Main APIs</a>
              <ul class="j2-nav-sublist">
                <li>
                  <a class="j2-nav-item" href="Classes/RbGateway.html">RbGateway</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Classes/RbGateway/Verbosity.html">– Verbosity</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Classes/RbObject.html">RbObject</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Classes/RbObjectAccess.html">RbObjectAccess</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Structs/RbObjectCollection.html">RbObjectCollection</a>
                </li>
              </ul>
            </li>
            <li class="j2-nav-group">
              <a class="j2-nav-item" href="Swift%20Method%20APIs.html">Swift Method APIs</a>
              <ul class="j2-nav-sublist">
                <li>
                  <a class="j2-nav-item" href="Structs/RbMethodArgsSpec.html">RbMethodArgsSpec</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Swift%20Method%20APIs.html#s11RubyGateway16RbMethodCallbacka">RbMethodCallback</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Swift%20Method%20APIs.html#s11RubyGateway21RbBoundMethodCallbacka">RbBoundMethodCallback</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Swift%20Method%20APIs.html#s11RubyGateway25RbBoundMethodVoidCallbacka">RbBoundMethodVoidCallback</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Structs/RbMethod.html">RbMethod</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Structs/RbMethodArgs.html">RbMethodArgs</a>
                </li>
              </ul>
            </li>
            <li class="j2-nav-group">
              <a class="j2-nav-item" href="Other%20APIs.html">Other APIs</a>
              <ul class="j2-nav-sublist">
                <li>
                  <a class="j2-nav-item" href="Other%20APIs.html#s11RubyGateway15RbBlockCallbacka">RbBlockCallback</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Enums/RbBlockRetention.html">RbBlockRetention</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Structs/RbBreak.html">RbBreak</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Structs/RbProc.html">RbProc</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Structs/RbSymbol.html">RbSymbol</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Enums/RbThread.html">RbThread</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Enums/RbThread/UnblockingFunc.html">– UnblockingFunc</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Enums/RbType.html">RbType</a>
                </li>
              </ul>
            </li>
            <li class="j2-nav-group">
              <a class="j2-nav-item" href="Error%20Handling.html">Error Handling</a>
              <ul class="j2-nav-sublist">
                <li>
                  <a class="j2-nav-item" href="Enums/RbError.html">RbError</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Enums/RbError/History.html">– History</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Structs/RbException.html">RbException</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Structs/RbFailableAccess.html">RbFailableAccess</a>
                </li>
              </ul>
            </li>
            <li class="j2-nav-group">
              <a class="j2-nav-item" href="Swift%20Interop.html">Swift Interop</a>
              <ul class="j2-nav-sublist">
                <li>
                  <a class="j2-nav-item" href="Protocols/RbObjectConvertible.html">RbObjectConvertible</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/String.html">String</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Bool.html">Bool</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/UInt.html">UInt</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/UInt64.html">UInt64</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/UInt32.html">UInt32</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/UInt16.html">UInt16</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/UInt8.html">UInt8</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Int.html">Int</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Int64.html">Int64</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Int32.html">Int32</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Int16.html">Int16</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Int8.html">Int8</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Double.html">Double</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Float.html">Float</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Array.html">Array</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/ArraySlice.html">ArraySlice</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Dictionary.html">Dictionary</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Set.html">Set</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/Range.html">Range</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Extensions/ClosedRange.html">ClosedRange</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Structs/RbComplex.html">RbComplex</a>
                </li>
                <li>
                  <a class="j2-nav-item" href="Structs/RbRational.html">RbRational</a>
                </li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
      <main class="col col-xl-8 j2-article px-lg-4 px-xl-5" id="article-column">
        <article class="j2-article-wrapper" id="main-content">

        <!-- todo top of article.... -->

        <section>

          <div class="clearfix">
            <!--
RubyGateway
README.md
Distributed under the MIT license, see LICENSE.
-->
<h1 id='rubygateway' class='j2-anchor heading'><span data-anchor-id=rubygateway>RubyGateway</span></h1>

<p><a href="https://travis-ci.org/johnfairh/RubyGateway"><img src="https://travis-ci.org/johnfairh/RubyGateway.svg?branch=master" alt="CI"></a>
<a href="https://codecov.io/gh/johnfairh/RubyGateway"><img src="https://codecov.io/gh/johnfairh/RubyGateway/branch/master/graph/badge.svg" alt="codecov"></a>
<a href="https://github.com/Carthage/Carthage"><img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage compatible"></a>
<img src="https://cocoapod-badges.herokuapp.com/v/RubyGateway/badge.png" alt="Pod">
<img src="https://img.shields.io/badge/platform-macOS%20%7C%20linux-lightgrey.svg" alt="Platforms">
<img src="https://cocoapod-badges.herokuapp.com/l/RubyGateway/badge.png" alt="License"></p>

<p>Embed Ruby in Swift: load Gems, run Ruby scripts, invoke APIs seamlessly in
both directions.</p>

<p>RubyGateway is a framework built on the Ruby C API that lets Swift programs
running on macOS or Linux painlessly and safely run and interact with Ruby
programs.  It&rsquo;s easy to pass Swift values into Ruby and turn Ruby objects
back into Swift types.</p>

<p>RubyGateway lets you call any Ruby method from Swift, including passing Swift
closures as blocks.  It lets you define Ruby classes and methods that are
implemented in Swift.</p>

<p>See <a href="https://github.com/johnfairh/CRuby">CRuby</a> if you are looking for a
low-level Ruby C API wrapper.</p>

<ul>
<li><a href="#examples">Examples</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#requirement">Requirements</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#contributions">Contributions</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2 id='examples' class='j2-anchor heading'><span data-anchor-id=examples>Examples</span></h2>
<h3 id='services' class='j2-anchor heading'><span data-anchor-id=services>Services</span></h3>

<p><a href="https://github.com/jneen/rouge">Rouge</a> is a code highlighter.  In Ruby:</p>
<pre><code class="language-ruby">require &#39;rouge&#39;
html = Rouge.highlight(&quot;let a = 3&quot;, &quot;swift&quot;, &quot;html&quot;)
puts(html)
</code></pre>
<p>In Swift:</p>
<pre><code class="language-swift">import RubyGateway

try Ruby.require(filename: &quot;rouge&quot;)
let html = try Ruby.get(&quot;Rouge&quot;).call(&quot;highlight&quot;, args: [&quot;let a = 3&quot;, &quot;swift&quot;, &quot;html&quot;])
print(html)
</code></pre><h3 id='calling-ruby' class='j2-anchor heading'><span data-anchor-id=calling-ruby>Calling Ruby</span></h3>
<pre><code class="language-swift">// Create an object.  Use keyword arguments with initializer
let student = RbObject(ofClass: &quot;Academy::Student&quot;, kwArgs: [&quot;name&quot;: &quot;barney&quot;])!

// Acess an attribute
print(&quot;Name is \(student.get(&quot;name&quot;))&quot;)

// Fix their name by poking an ivar
try! student.setInstanceVar(&quot;@name&quot;, newValue: &quot;Barney&quot;)

// Get a Swift version of `:reading`
let readingSubject = RbSymbol(&quot;reading&quot;)

// Call a method with mixed Swift data types
try! student.call(&quot;add_score&quot;, args: [readingSubject, 30])
try! student.call(&quot;add_score&quot;, args: [readingSubject, 35])

// Get a result as floating point
let avgScoreObj = try! student.call(&quot;mean_score_for_subject&quot;, args: [readingSubject])
let avgScore = Double(avgScoreObj)!
print(&quot;Mean score is \(avgScore)&quot;)

// Pass Swift code as a block
let scores = student.all_scores!
scores.call(&quot;each&quot;) { args in
    print(&quot;Subject: \(args[0]) Score: \(args[1])&quot;)
    return .nilObject
}

// Convert to a Swift array
let subjects = Array&lt;String&gt;(student.all_subjects!)
subjectsPopularityDb.submit(subjects: subjects)
</code></pre><h2 id='calling-swift' class='j2-anchor heading'><span data-anchor-id=calling-swift>Calling Swift</span></h2>

<p>Bound class definition:</p>
<pre><code class="language-swift">class Cell {
    init() {
    }

    func setup(m: RbMethod) throws {
        ...
    }

    func getContent(m: RbMethod) throws -&gt; String {
        ...
    }
}

let cellClass = try Ruby.defineClass(&quot;Cell&quot;, initializer: Cell.init)

try cellClass.defineMethod(&quot;initialize&quot;,
        argsSpec: RbMethodArgsSpec(mandatoryKeywords: [&quot;width&quot;, &quot;height&quot;])
        method: Cell.setup)

try cellClass.defineMethod(&quot;content&quot;,
        argsSpec: RbMethodArgsSpec(requiresBlock: true),
        method: Cell.getContent)
</code></pre>
<p>Called from Ruby:</p>
<pre><code class="language-ruby">cell = Cell.new(width: 200, height: 100)
cell.content { |c| prettyprint(c) }
</code></pre>
<p>Global variables:</p>
<pre><code class="language-swift">// epochStore.current: Int

Ruby.defineGlobalVar(&quot;$epoch&quot;,
        get: { epochStore.current },
        set: { epochStore.current = newEpoch })
</code></pre>
<p>Global functions:</p>
<pre><code class="language-swift">let logArgsSpec = RbMethodArgsSpec(leadingMandatoryCount: 1,
                                   optionalKeywordValues: [&quot;priority&quot; : 0])
try Ruby.defineGlobalFunction(&quot;log&quot;,
                              argsSpec: logArgsSpec) { _, method in
    Logger.log(message: String(method.args.mandatory[0]),
               priority: Int(method.args.keyword[&quot;priority&quot;]!))
    return .nilObject
}
</code></pre>
<p>Calls from Ruby:</p>
<pre><code class="language-ruby">log(object_to_log)
log(object2_to_log, priority: 2)
</code></pre><h2 id='documentation' class='j2-anchor heading'><span data-anchor-id=documentation>Documentation</span></h2>

<ul>
<li><a href="https://johnfairh.github.io/RubyGateway/user-guide.html">User guide</a></li>
<li><a href="https://johnfairh.github.io/RubyGateway">API documentation</a></li>
<li><a href="https://johnfairh.github.io/RubyGateway/docsets/RubyGateway.tgz">Docset for Dash</a></li>
</ul>
<h2 id='requirements' class='j2-anchor heading'><span data-anchor-id=requirements>Requirements</span></h2>

<ul>
<li>Swift 5.0 or later, from swift.org or Xcode 10.2+</li>
<li>macOS (tested on 10.14.5) or Linux (tested on Ubuntu Bionic/18.04 on x86_64) with Clang 6.</li>
<li>Ruby 2.3 or later including development files:

<ul>
<li>For macOS, these come with Xcode.</li>
<li>For Linux you may need to install a -dev package depending on how your Ruby
is installed.</li>
<li>RubyGateway requires &lsquo;original&rsquo; MRI/CRuby Ruby - no JRuby/Rubinius/etc.</li>
</ul></li>
</ul>
<h2 id='installation' class='j2-anchor heading'><span data-anchor-id=installation>Installation</span></h2>

<p>For macOS, if you are happy to use the system Ruby then you just need to include
the RubyGateway framework as a dependency.  If you are building on Linux or want
to use a different Ruby then you also need to configure CRuby.</p>
<h3 id='getting-the-framework' class='j2-anchor heading'><span data-anchor-id=getting-the-framework>Getting the framework</span></h3>

<p>Carthage for macOS:</p>
<pre><code class="language-">github &quot;johnfairh/RubyGateway&quot;
</code></pre>
<p>Swift package manager for macOS or Linux:</p>
<pre><code class="language-">.package(url: &quot;https://github.com/johnfairh/RubyGateway&quot;, from: &quot;2.1.0&quot;)
</code></pre>
<p>CocoaPods for macOS:</p>
<pre><code class="language-">pod &#39;RubyGateway&#39;
</code></pre><h3 id='configuring-cruby' class='j2-anchor heading'><span data-anchor-id=configuring-cruby>Configuring CRuby</span></h3>

<p>CRuby is the glue between RubyGateway and your Ruby installation.  It is a
<a href="https://github.com/johnfairh/CRuby">separate github project</a> but RubyGateway
includes it as submodule so you do not install or require it separately.</p>

<p>By default it points to the macOS system Ruby.  Follow the <a href="https://github.com/johnfairh/CRuby#usage">CRuby usage
instructions</a> to change
this.  For example on Linux using <a href="https://www.brightbox.com/docs/ruby/ubuntu/">Brightbox Ruby</a>
2.5:</p>
<pre><code class="language-shell">sudo apt-get install ruby2.5 ruby2.5-dev pkg-config
mkdir MyProject &amp;&amp; cd MyProject
swift package init --type executable
vi Package.swift
# add RubyGateway as a package dependency (NOT CRuby)
# add RubyGateway as a target dependency
echo &quot;import RubyGateway; print(Ruby.versionDescription)&quot; &gt; Sources/MyProject/main.swift
swift package update
swift package edit CRuby
Packages/CRuby/cfg-cruby --mode pkg-config --name ruby-2.5
PKG_CONFIG_PATH=$(pwd)/Packages/CRuby:$PKG_CONFIG_PATH swift run
</code></pre><h2 id='contributions' class='j2-anchor heading'><span data-anchor-id=contributions>Contributions</span></h2>

<p>Welcome: open an issue / <a href="mailto:johnfairh@gmail.com">johnfairh@gmail.com</a> / @johnfairh</p>
<h2 id='license' class='j2-anchor heading'><span data-anchor-id=license>License</span></h2>

<p>Distributed under the MIT license.</p>

          </div>
        </section>


        </article>
      </main>

      <!-- aux nav -->

      <div class="col-xl d-none d-xl-block j2-aux-nav" id="aux-nav-column">
        <div class="j2-aux-nav-wrapper">
          <h6 class="j2-inline-heading">Topics</h6>
          <nav aria-label="page">
            <ul class="j2-aux-group">
              <li><a href="#">Declaration</a></li>
            </ul>
          </nav>
          <h6 class="j2-inline-heading">Actions</h6>
          <ul class="j2-aux-group">
            <li><a class="j2-aux-action" id="action-search" href="#" role="button" aria-keyshortcuts="/">Search (/)</a></li>
            <li><a class="j2-aux-action" id="action-collapse" href="#" role="button" aria-keyshortcuts="a">
              <span id="action-collapse-expand">Open all (a)</span>
              <span id="action-collapse-collapse" class="d-none">Close all (a)</span>
            </a></li>
          </ul>
        </div>
      </div>

    </div> <!-- end row -->

    <footer class="row">
      <div class="col j2-footer small pt-2">
        <p><p>Distributed under the MIT license.  Maintained by <a class="link" href="mailto:johnfairh@gmail.com" target="_blank" rel="external">John Fairhurst</a>.</p></p>
        <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.1</a>-<a class="link" href="https://github.com/johnfairh/jazzy" target="_blank" rel="external">bebop</a>, originally a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.  Theme from <a href="https://github.com/johnfairh/J2">J2</a>.</p>
      </div>
    </footer>
  </div> <!-- container -->

  <script src="js/dependencies.min.js"></script>
  <script src="js/fw2020.js"></script>
  </body>

</html>
